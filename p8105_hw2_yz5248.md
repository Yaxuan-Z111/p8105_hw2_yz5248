p8105_hw2_yz5248
================
yz5248
2025-09-24

``` r
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   4.0.0     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(lubridate)
library(janitor)
```

    ## 
    ## Attaching package: 'janitor'
    ## 
    ## The following objects are masked from 'package:stats':
    ## 
    ##     chisq.test, fisher.test

``` r
library(readr)
library(readxl)
```

Problem 1. First, clean the data in pols-month.csv.  
Breaking up the variable mon into integer variables year, month, and
day.  
Replacing month number with month name.  
Creating a president variable taking values gop and dem, and remove
prez_dem and prez_gop; and remove the day variable.

``` r
pols_clean = read_csv("fivethirtyeight_datasets/pols-month.csv")|>
  separate(mon, into = c("year", "month", "day"), sep = "-") |>
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    month = month.name[month],
    president = if_else(prez_gop == 1, "gop", "dem")
  ) |>
  select(-prez_gop, -prez_dem, -day)
```

``` r
snp_clean = read_csv("fivethirtyeight_datasets/snp.csv") |>
  separate(date, into = c("month", "day", "year"), sep = "/") |> 
  mutate(
    # 把 year 转成 4 位数
    year = as.integer(if_else(as.integer(year) > 50, paste0("19", year), paste0("20", year))),
    month = as.integer(month),
    month = month.name[month]
  ) |>
  select(year, month, close) |>
  arrange(year, match(month, month.name))
```

``` r
unemp_clean = unemp <- read_csv("fivethirtyeight_datasets/unemployment.csv")|>
  pivot_longer(
    cols = Jan:Dec,
    names_to = "month",
    values_to = "unemployment"
  ) |>
  mutate(month = recode(month,
                        Jan="January", Feb="February", Mar="March",
                        Apr="April", May="May", Jun="June",
                        Jul="July", Aug="August", Sep="September",
                        Oct="October", Nov="November", Dec="December")) |>
  rename(year = Year)
```

``` r
merged_data = pols_clean |>
  left_join(snp_clean, by = c("year", "month")) |>
  left_join(unemp_clean, by = c("year", "month"))

tibble(
  Rows = nrow(merged_data),
  Columns = ncol(merged_data),
  Year_Min = min(merged_data$year, na.rm = TRUE),
  Year_Max = max(merged_data$year, na.rm = TRUE)
)
```

    ## # A tibble: 1 × 4
    ##    Rows Columns Year_Min Year_Max
    ##   <int>   <int>    <dbl>    <dbl>
    ## 1   822      11     1947     2015

Problem 2.

``` r
mr_trash_wheel = read_excel(
  "202409 Trash Wheel Collection Data.xlsx",sheet = "Mr. Trash Wheel", skip = 1) |>
  janitor::clean_names() |>       # make column names snake_case
  filter(!is.na(dumpster)) |>     # keep only rows with data
  mutate(
    year = as.integer(year),
    sports_balls = as.integer(round(sports_balls)),
    trash_wheel = "Mr. Trash Wheel"
  )
```

``` r
prof_trash_wheel = read_excel(
  "202409 Trash Wheel Collection Data.xlsx",
  sheet = "Professor Trash Wheel",
  skip = 1,
) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster))|>
  mutate(
    year = as.integer(year)
  )

gwynnda = read_excel(
  "202409 Trash Wheel Collection Data.xlsx",
  sheet = "Gwynnda Trash Wheel",
  skip = 1,
) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster))|>
  mutate(
    year = as.integer(year)
  )

trash_wheel_data = bind_rows(mr_trash_wheel, prof_trash_wheel, gwynnda)
```

Problem 3.

``` r
zip_df = read_csv(
  "zillow_data/Zip Codes.csv"
  ) |> 
  janitor::clean_names() |>
  mutate(zip = str_pad(as.character(zip_code), 5, pad = "0")) |>
  distinct(zip, .keep_all = TRUE)

zori_wide = read_csv(
  "zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv"
  ) |> 
  janitor::clean_names()
```

``` r
zori_long = zori_wide |>
  pivot_longer(
    cols = starts_with("x"),  
    names_to = "date",
    values_to = "zori"
  ) |>
  mutate(
    date = ymd(str_remove(date, "^x")),  
    zori = as.numeric(zori),
    zip = str_pad(region_name, 5, pad = "0")  
  ) |>
  drop_na(zori)

view(zori_long)
```

``` r
zori_merged = zori_long |>
  left_join(zip_df, by = "zip") |>
  select(zip, county, neighborhood, date, zori, everything())

zori_merged
```

    ## # A tibble: 10,450 × 19
    ##    zip   county neighborhood    date        zori region_id size_rank region_name
    ##    <chr> <chr>  <chr>           <date>     <dbl>     <dbl>     <dbl>       <dbl>
    ##  1 11368 Queens West Queens     2024-07-31 2322.     62080         4       11368
    ##  2 11368 Queens West Queens     2024-08-31 2282.     62080         4       11368
    ##  3 11385 Queens West Central Q… 2016-05-31 2266.     62093         7       11385
    ##  4 11385 Queens West Central Q… 2016-06-30 2292.     62093         7       11385
    ##  5 11385 Queens West Central Q… 2016-07-31 2321.     62093         7       11385
    ##  6 11385 Queens West Central Q… 2016-08-31 2343.     62093         7       11385
    ##  7 11385 Queens West Central Q… 2016-09-30 2337.     62093         7       11385
    ##  8 11385 Queens West Central Q… 2016-10-31 2345.     62093         7       11385
    ##  9 11385 Queens West Central Q… 2016-11-30 2320.     62093         7       11385
    ## 10 11385 Queens West Central Q… 2016-12-31 2326.     62093         7       11385
    ## # ℹ 10,440 more rows
    ## # ℹ 11 more variables: region_type <chr>, state_name <chr>, state <chr>,
    ## #   city <chr>, metro <chr>, county_name <chr>, state_fips <dbl>,
    ## #   county_code <chr>, county_fips <dbl>, zip_code <dbl>, file_date <chr>

The dataset contains 10450 total observations, covering 149 unique ZIP
codes in the ZORI data and 320 unique ZIP codes in the lookup table. The
number of unique neighborhoods is 43.
