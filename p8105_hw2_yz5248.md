p8105_hw2_yz5248
================
yz5248
2025-09-24

``` r
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   4.0.0     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(lubridate)
library(janitor)
```

    ## 
    ## Attaching package: 'janitor'
    ## 
    ## The following objects are masked from 'package:stats':
    ## 
    ##     chisq.test, fisher.test

``` r
library(readr)
library(readxl)
```

\#Problem 1.  
Dealing with the data in pols-month.csv.

``` r
pols_df = read_csv("fivethirtyeight_datasets/pols-month.csv")|>
  separate(mon, into = c("year", "month", "day"), sep = "-") |>
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    month = month.name[month],
    president = if_else(prez_gop == 1, "gop", "dem")
  ) |>
  select(-prez_gop, -prez_dem, -day)
pols_df
```

    ## # A tibble: 822 × 9
    ##     year month     gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president
    ##    <int> <chr>       <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>    
    ##  1  1947 January        23      51     253      23      45     198 dem      
    ##  2  1947 February       23      51     253      23      45     198 dem      
    ##  3  1947 March          23      51     253      23      45     198 dem      
    ##  4  1947 April          23      51     253      23      45     198 dem      
    ##  5  1947 May            23      51     253      23      45     198 dem      
    ##  6  1947 June           23      51     253      23      45     198 dem      
    ##  7  1947 July           23      51     253      23      45     198 dem      
    ##  8  1947 August         23      51     253      23      45     198 dem      
    ##  9  1947 September      23      51     253      23      45     198 dem      
    ## 10  1947 October        23      51     253      23      45     198 dem      
    ## # ℹ 812 more rows

pols_df from FiveThirtyEight contains 822 monthly observations of
political office holdings in the United States, spanning the years 1947
to 2014. Each observation related to the number of national politicians
who are democratic or republican at any given time, including gov_gop
and gov_dem (number of Republican and Democratic governors), sen_gop and
sen_dem (senators), and rep_gop and rep_dem (representatives). The
dataset also includes indicators for the party of the sitting president
(prez_gop and prez_dem). The ‘mon’ variable in the original file was
converted to separate ‘year’ and ‘month’ columns for clarity.

Dealing with the data in snp.csv.

``` r
snp_df = read_csv("fivethirtyeight_datasets/snp.csv") |>
  separate(date, into = c("month", "day", "year"), sep = "/") |> 
  mutate(
    year = as.integer(if_else(as.integer(year) > 50, paste0("19", year), paste0("20", year))),
    month = as.integer(month),
    month = month.name[month]
  ) |>
  select(year, month, close) |>
  arrange(year, match(month, month.name))
snp_df
```

    ## # A tibble: 787 × 3
    ##     year month     close
    ##    <int> <chr>     <dbl>
    ##  1  1951 January    21.7
    ##  2  1951 February   21.8
    ##  3  1951 March      21.5
    ##  4  1951 April      22.4
    ##  5  1951 May        21.5
    ##  6  1951 June       21.0
    ##  7  1951 July       22.4
    ##  8  1951 August     23.3
    ##  9  1951 September  23.3
    ## 10  1951 October    22.9
    ## # ℹ 777 more rows

snp_df dataset related to Standard & Poor’s stock market index (S&P),
often used as a representative measure of stock market as a whole and
provided for this analysis contains 787 monthly observations from 1951
onward, with two key variables: date, the observation date, and close,
the closing value of the S&P 500 index on that date.

Dealing with the data in unemployment.cvs

``` r
unemp_df = read_csv("fivethirtyeight_datasets/unemployment.csv")|>
  pivot_longer(
    cols = Jan:Dec,
    names_to = "month",
    values_to = "unemployment"
  ) |>
  mutate(month = recode(month,
                        Jan="January", Feb="February", Mar="March",
                        Apr="April", May="May", Jun="June",
                        Jul="July", Aug="August", Sep="September",
                        Oct="October", Nov="November", Dec="December")) |>
  rename(year = Year)
unemp_df
```

    ## # A tibble: 816 × 3
    ##     year month     unemployment
    ##    <dbl> <chr>            <dbl>
    ##  1  1948 January            3.4
    ##  2  1948 February           3.8
    ##  3  1948 March              4  
    ##  4  1948 April              3.9
    ##  5  1948 May                3.5
    ##  6  1948 June               3.6
    ##  7  1948 July               3.6
    ##  8  1948 August             3.9
    ##  9  1948 September          3.8
    ## 10  1948 October            3.7
    ## # ℹ 806 more rows

unemp_df dataset contains monthly U.S. unemployment rates from 1948 to
2015, with 816 observations and three variables: year, month, and
unemployment rate in the month of the associated year.

Merging the datasets and give brief discription

``` r
merged_df = pols_df |>
  left_join(snp_df, by = c("year", "month")) |>
  left_join(unemp_df, by = c("year", "month"))

merged_df
```

    ## # A tibble: 822 × 11
    ##     year month   gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president close
    ##    <dbl> <chr>     <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>     <dbl>
    ##  1  1947 January      23      51     253      23      45     198 dem          NA
    ##  2  1947 Februa…      23      51     253      23      45     198 dem          NA
    ##  3  1947 March        23      51     253      23      45     198 dem          NA
    ##  4  1947 April        23      51     253      23      45     198 dem          NA
    ##  5  1947 May          23      51     253      23      45     198 dem          NA
    ##  6  1947 June         23      51     253      23      45     198 dem          NA
    ##  7  1947 July         23      51     253      23      45     198 dem          NA
    ##  8  1947 August       23      51     253      23      45     198 dem          NA
    ##  9  1947 Septem…      23      51     253      23      45     198 dem          NA
    ## 10  1947 October      23      51     253      23      45     198 dem          NA
    ## # ℹ 812 more rows
    ## # ℹ 1 more variable: unemployment <dbl>

``` r
tibble(
  Rows = nrow(merged_df),
  Columns = ncol(merged_df),
  Year_Min = min(merged_df$year, na.rm = TRUE),
  Year_Max = max(merged_df$year, na.rm = TRUE)
)
```

    ## # A tibble: 1 × 4
    ##    Rows Columns Year_Min Year_Max
    ##   <int>   <int>    <dbl>    <dbl>
    ## 1   822      11     1947     2015

resulting dataset is a tidy, merged compilation of political, economic,
and financial data, containing 822 rows and 11 variables, spanning the
years 1947 to 2015. Key variables include ‘year’ and ‘month’ to identify
the time period, political seat counts for Republicans and Democrats in
the House and Senate (gov_gop, sen_gop, rep_gop, gov_dem, sen_dem,
rep_dem), the party of the sitting president (president), the monthly
closing value of the S&P 500 (close), and the monthly U.S. unemployment
rate (unemployment).

\#Problem 2.

``` r
mr_trash_wheel = read_excel(
  "202409 Trash Wheel Collection Data.xlsx",sheet = "Mr. Trash Wheel", skip = 1) |>
  janitor::clean_names() |>      
  filter(!is.na(dumpster)) |>    
  mutate(
    year = as.integer(year),
    sports_balls = as.integer(round(sports_balls)),
    trash_wheel = "Mr. Trash Wheel"
  )
mr_trash_wheel
```

    ## # A tibble: 651 × 17
    ##    dumpster month  year date                weight_tons volume_cubic_yards
    ##       <dbl> <chr> <int> <dttm>                    <dbl>              <dbl>
    ##  1        1 May    2014 2014-05-16 00:00:00        4.31                 18
    ##  2        2 May    2014 2014-05-16 00:00:00        2.74                 13
    ##  3        3 May    2014 2014-05-16 00:00:00        3.45                 15
    ##  4        4 May    2014 2014-05-17 00:00:00        3.1                  15
    ##  5        5 May    2014 2014-05-17 00:00:00        4.06                 18
    ##  6        6 May    2014 2014-05-20 00:00:00        2.71                 13
    ##  7        7 May    2014 2014-05-21 00:00:00        1.91                  8
    ##  8        8 May    2014 2014-05-28 00:00:00        3.7                  16
    ##  9        9 June   2014 2014-06-05 00:00:00        2.52                 14
    ## 10       10 June   2014 2014-06-11 00:00:00        3.76                 18
    ## # ℹ 641 more rows
    ## # ℹ 11 more variables: plastic_bottles <dbl>, polystyrene <dbl>,
    ## #   cigarette_butts <dbl>, glass_bottles <dbl>, plastic_bags <dbl>,
    ## #   wrappers <dbl>, sports_balls <int>, homes_powered <dbl>, x15 <lgl>,
    ## #   x16 <lgl>, trash_wheel <chr>

``` r
prof_trash_wheel = read_excel(
  "202409 Trash Wheel Collection Data.xlsx",
  sheet = "Professor Trash Wheel",
  skip = 1,
) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster))|>
  mutate(
    year = as.integer(year)
  )
prof_trash_wheel
```

    ## # A tibble: 119 × 13
    ##    dumpster month     year date                weight_tons volume_cubic_yards
    ##       <dbl> <chr>    <int> <dttm>                    <dbl>              <dbl>
    ##  1        1 January   2017 2017-01-02 00:00:00        1.79                 15
    ##  2        2 January   2017 2017-01-30 00:00:00        1.58                 15
    ##  3        3 February  2017 2017-02-26 00:00:00        2.32                 18
    ##  4        4 February  2017 2017-02-26 00:00:00        3.72                 15
    ##  5        5 February  2017 2017-02-28 00:00:00        1.45                 15
    ##  6        6 March     2017 2017-03-30 00:00:00        1.71                 15
    ##  7        7 April     2017 2017-04-01 00:00:00        1.82                 15
    ##  8        8 April     2017 2017-04-20 00:00:00        2.37                 15
    ##  9        9 May       2017 2017-05-10 00:00:00        2.64                 15
    ## 10       10 May       2017 2017-05-26 00:00:00        2.78                 15
    ## # ℹ 109 more rows
    ## # ℹ 7 more variables: plastic_bottles <dbl>, polystyrene <dbl>,
    ## #   cigarette_butts <dbl>, glass_bottles <dbl>, plastic_bags <dbl>,
    ## #   wrappers <dbl>, homes_powered <dbl>

``` r
gwynnda = read_excel(
  "202409 Trash Wheel Collection Data.xlsx",
  sheet = "Gwynnda Trash Wheel",
  skip = 1,
) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster))|>
  mutate(
    year = as.integer(year)
  )
gwynnda
```

    ## # A tibble: 263 × 12
    ##    dumpster month   year date                weight_tons volume_cubic_yards
    ##       <dbl> <chr>  <int> <dttm>                    <dbl>              <dbl>
    ##  1        1 July    2021 2021-07-03 00:00:00        0.93                 15
    ##  2        2 July    2021 2021-07-07 00:00:00        2.26                 15
    ##  3        3 July    2021 2021-07-07 00:00:00        1.62                 15
    ##  4        4 July    2021 2021-07-16 00:00:00        1.76                 15
    ##  5        5 July    2021 2021-07-30 00:00:00        1.53                 15
    ##  6        6 August  2021 2021-08-11 00:00:00        2.06                 15
    ##  7        7 August  2021 2021-08-14 00:00:00        1.9                  15
    ##  8        8 August  2021 2021-08-16 00:00:00        2.16                 15
    ##  9        9 August  2021 2021-08-16 00:00:00        2.6                  15
    ## 10       10 August  2021 2021-08-17 00:00:00        3.21                 15
    ## # ℹ 253 more rows
    ## # ℹ 6 more variables: plastic_bottles <dbl>, polystyrene <dbl>,
    ## #   cigarette_butts <dbl>, plastic_bags <dbl>, wrappers <dbl>,
    ## #   homes_powered <dbl>

``` r
trash_wheel_data = bind_rows(mr_trash_wheel, prof_trash_wheel, gwynnda)
trash_wheel_data
```

    ## # A tibble: 1,033 × 17
    ##    dumpster month  year date                weight_tons volume_cubic_yards
    ##       <dbl> <chr> <int> <dttm>                    <dbl>              <dbl>
    ##  1        1 May    2014 2014-05-16 00:00:00        4.31                 18
    ##  2        2 May    2014 2014-05-16 00:00:00        2.74                 13
    ##  3        3 May    2014 2014-05-16 00:00:00        3.45                 15
    ##  4        4 May    2014 2014-05-17 00:00:00        3.1                  15
    ##  5        5 May    2014 2014-05-17 00:00:00        4.06                 18
    ##  6        6 May    2014 2014-05-20 00:00:00        2.71                 13
    ##  7        7 May    2014 2014-05-21 00:00:00        1.91                  8
    ##  8        8 May    2014 2014-05-28 00:00:00        3.7                  16
    ##  9        9 June   2014 2014-06-05 00:00:00        2.52                 14
    ## 10       10 June   2014 2014-06-11 00:00:00        3.76                 18
    ## # ℹ 1,023 more rows
    ## # ℹ 11 more variables: plastic_bottles <dbl>, polystyrene <dbl>,
    ## #   cigarette_butts <dbl>, glass_bottles <dbl>, plastic_bags <dbl>,
    ## #   wrappers <dbl>, sports_balls <int>, homes_powered <dbl>, x15 <lgl>,
    ## #   x16 <lgl>, trash_wheel <chr>

The combined trash collection dataset contains 1033 observations across
multiple trash wheels, including Mr. Trash Wheel, Professor Trash Wheel,
and Gwynnda. Key variables include `dumpster`, `month`, `year`,
`weight_tons` (the weight of trash collected), `cigarette_butts`,
`plastic_bottles`, and `trash_wheel` (the collector). Across the
available data, the total weight of trash collected by Professor Trash
Wheel was 0 tons. In June 2022, Gwynnda collected a total of 0 cigarette
butts.

\#Problem 3.

``` r
zip_df = read_csv(
  "zillow_data/Zip Codes.csv"
  ) |> 
  janitor::clean_names() |>
  mutate(zip = as.character(zip_code))

zori_wide = read_csv(
  "zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv"
  ) |> 
  janitor::clean_names()

zip_df
```

    ## # A tibble: 322 × 8
    ##    county state_fips county_code county_fips zip_code file_date neighborhood    
    ##    <chr>       <dbl> <chr>             <dbl>    <dbl> <chr>     <chr>           
    ##  1 Bronx          36 005               36005    10451 7/25/07   High Bridge and…
    ##  2 Bronx          36 005               36005    10452 7/25/07   High Bridge and…
    ##  3 Bronx          36 005               36005    10453 7/25/07   Central Bronx   
    ##  4 Bronx          36 005               36005    10454 7/25/07   Hunts Point and…
    ##  5 Bronx          36 005               36005    10455 7/25/07   Hunts Point and…
    ##  6 Bronx          36 005               36005    10456 7/25/07   High Bridge and…
    ##  7 Bronx          36 005               36005    10457 7/25/07   Central Bronx   
    ##  8 Bronx          36 005               36005    10458 7/25/07   Bronx Park and …
    ##  9 Bronx          36 005               36005    10459 7/25/07   Hunts Point and…
    ## 10 Bronx          36 005               36005    10460 7/25/07   Central Bronx   
    ## # ℹ 312 more rows
    ## # ℹ 1 more variable: zip <chr>

``` r
zori_long = zori_wide |>
  pivot_longer(
    cols = starts_with("x"),  
    names_to = "date",
    values_to = "zori"
  ) |>
  mutate(
    date = ymd(str_remove(date, "^x")),  
    zori = as.numeric(zori),
    zip = str_pad(region_name, 5, pad = "0")  
  ) |>
  drop_na(zori)

zori_long
```

    ## # A tibble: 10,450 × 12
    ##    region_id size_rank region_name region_type state_name state city     metro  
    ##        <dbl>     <dbl>       <dbl> <chr>       <chr>      <chr> <chr>    <chr>  
    ##  1     62080         4       11368 zip         NY         NY    New York New Yo…
    ##  2     62080         4       11368 zip         NY         NY    New York New Yo…
    ##  3     62093         7       11385 zip         NY         NY    New York New Yo…
    ##  4     62093         7       11385 zip         NY         NY    New York New Yo…
    ##  5     62093         7       11385 zip         NY         NY    New York New Yo…
    ##  6     62093         7       11385 zip         NY         NY    New York New Yo…
    ##  7     62093         7       11385 zip         NY         NY    New York New Yo…
    ##  8     62093         7       11385 zip         NY         NY    New York New Yo…
    ##  9     62093         7       11385 zip         NY         NY    New York New Yo…
    ## 10     62093         7       11385 zip         NY         NY    New York New Yo…
    ## # ℹ 10,440 more rows
    ## # ℹ 4 more variables: county_name <chr>, date <date>, zori <dbl>, zip <chr>

``` r
zori_merged = zori_long |>
  left_join(zip_df, by = "zip") |>
  select(zip, county, neighborhood, date, zori, everything())

zori_merged
```

    ## # A tibble: 10,677 × 19
    ##    zip   county neighborhood    date        zori region_id size_rank region_name
    ##    <chr> <chr>  <chr>           <date>     <dbl>     <dbl>     <dbl>       <dbl>
    ##  1 11368 Queens West Queens     2024-07-31 2322.     62080         4       11368
    ##  2 11368 Queens West Queens     2024-08-31 2282.     62080         4       11368
    ##  3 11385 Queens West Central Q… 2016-05-31 2266.     62093         7       11385
    ##  4 11385 Queens West Central Q… 2016-06-30 2292.     62093         7       11385
    ##  5 11385 Queens West Central Q… 2016-07-31 2321.     62093         7       11385
    ##  6 11385 Queens West Central Q… 2016-08-31 2343.     62093         7       11385
    ##  7 11385 Queens West Central Q… 2016-09-30 2337.     62093         7       11385
    ##  8 11385 Queens West Central Q… 2016-10-31 2345.     62093         7       11385
    ##  9 11385 Queens West Central Q… 2016-11-30 2320.     62093         7       11385
    ## 10 11385 Queens West Central Q… 2016-12-31 2326.     62093         7       11385
    ## # ℹ 10,667 more rows
    ## # ℹ 11 more variables: region_type <chr>, state_name <chr>, state <chr>,
    ## #   city <chr>, metro <chr>, county_name <chr>, state_fips <dbl>,
    ## #   county_code <chr>, county_fips <dbl>, zip_code <dbl>, file_date <chr>

The dataset contains 10677 total observations, covering 149 unique ZIP
codes in the ZORI data and 320 unique ZIP codes in the lookup table. The
number of unique neighborhoods is 43.

``` r
missing_zips <- setdiff(zip_df$zip, zori_long$zip)
missing_zips
```

    ##   [1] "10464" "10474" "10475" "10499" "10550" "10704" "10705" "10803" "11202"
    ##  [10] "11224" "11239" "11241" "11242" "11243" "11245" "11247" "11251" "11252"
    ##  [19] "11256" "10008" "10020" "10041" "10043" "10045" "10047" "10048" "10055"
    ##  [28] "10072" "10080" "10081" "10082" "10087" "10101" "10102" "10103" "10104"
    ##  [37] "10105" "10106" "10107" "10108" "10109" "10110" "10111" "10112" "10113"
    ##  [46] "10114" "10115" "10116" "10117" "10118" "10119" "10120" "10121" "10122"
    ##  [55] "10123" "10124" "10125" "10126" "10129" "10130" "10131" "10132" "10133"
    ##  [64] "10138" "10149" "10150" "10151" "10152" "10153" "10154" "10155" "10156"
    ##  [73] "10157" "10158" "10159" "10160" "10161" "10163" "10164" "10165" "10166"
    ##  [82] "10167" "10168" "10169" "10170" "10171" "10172" "10173" "10174" "10175"
    ##  [91] "10176" "10177" "10178" "10179" "10185" "10197" "10199" "10213" "10242"
    ## [100] "10249" "10256" "10259" "10260" "10261" "10265" "10268" "10269" "10270"
    ## [109] "10271" "10272" "10273" "10274" "10275" "10276" "10277" "10278" "10279"
    ## [118] "10281" "10285" "10286" "10292" "11001" "11004" "11005" "11040" "11096"
    ## [127] "11351" "11352" "11359" "11362" "11363" "11371" "11380" "11381" "11386"
    ## [136] "11405" "11411" "11412" "11413" "11414" "11416" "11417" "11419" "11420"
    ## [145] "11421" "11422" "11423" "11424" "11425" "11427" "11428" "11429" "11430"
    ## [154] "11431" "11433" "11436" "11439" "11451" "11499" "11559" "11580" "11690"
    ## [163] "11694" "11695" "11697" "10302" "10307" "10309" "10310" "10311" "10313"

169 ZIP codes appear in the ZIP code dataset but not in the Zillow
Rental Price dataset.  
Many ZIP codes in the master dataset do not appear in the Zillow ZORI
dataset because they lack sufficient residential rental data. For
example, ZIP codes like 10499 (a USPS facility in the Bronx) and many
101xx codes in Midtown Manhattan are primarily assigned to large
buildings or corporate offices, with little to no housing. Others, such
as 11430 (covering JFK Airport) or 10474 (an industrial area), have few
rental units and therefore cannot produce a reliable rent index.

``` r
jan2020 = zori_long |> 
  filter(year(date) == 2020, month(date) == 1) |> 
  select(zip, zori) |> 
  rename(zori_2020 = zori)

jan2021 = zori_long |> 
  filter(year(date) == 2021, month(date) == 1) |> 
  select(zip, zori) |> 
  rename(zori_2021 = zori)

comp = inner_join(jan2020, jan2021, by = "zip") |>
  mutate(drop = zori_2021 - zori_2020) |>
  left_join(zip_df |>
              select(zip, neighborhood, county), 
            by = "zip")

top10_drops = comp |> 
  arrange(drop) |> 
  slice(1:10)

top10_drops
```

    ## # A tibble: 10 × 6
    ##    zip   zori_2020 zori_2021  drop neighborhood                  county  
    ##    <chr>     <dbl>     <dbl> <dbl> <chr>                         <chr>   
    ##  1 10007     6334.     5422. -913. Lower Manhattan               New York
    ##  2 10069     4623.     3875. -748. <NA>                          New York
    ##  3 10009     3406.     2692. -714. Lower East Side               New York
    ##  4 10016     3731.     3019. -712. Gramercy Park and Murray Hill New York
    ##  5 10001     4108.     3398. -710. Chelsea and Clinton           New York
    ##  6 10002     3645.     2935. -710. Lower East Side               New York
    ##  7 10004     3150.     2444. -706. Lower Manhattan               New York
    ##  8 10038     3573.     2876. -698. Lower Manhattan               New York
    ##  9 10012     3629.     2942. -686. Greenwich Village and Soho    New York
    ## 10 10010     3697.     3012. -685. Gramercy Park and Murray Hill New York

The result shows that the ZIP codes with the largest rent declines
between January 2020 and January 2021 are concentrated in Manhattan. The
area typically have high rents and are home to many young professionals
and office workers. During the pandemic, remote work, business closures,
and outmigration reduced demand for centrally located apartments,
driving sharp price drops. This pattern highlights how the pandemic
disproportionately affected dense urban rental markets compared to
outer-borough or suburban areas.
