---
title: "p8105_hw2_yz5248"
author: "yz5248"
date: "2025-09-24"
output: github_document
---

```{r}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(lubridate)
library(janitor)
library(readr)
library(readxl)
```

#Problem 1.   
Dealing with the data in pols-month.csv.  
```{r}
pols_df = read_csv("fivethirtyeight_datasets/pols-month.csv")|>
  separate(mon, into = c("year", "month", "day"), sep = "-") |>
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    month = month.name[month],
    president = if_else(prez_gop == 1, "gop", "dem")
  ) |>
  select(-prez_gop, -prez_dem, -day)
pols_df
```
pols_df from FiveThirtyEight contains 822 monthly observations of political office holdings in the United States, spanning the years 1947 to 2014. Each observation related to the number of national politicians who are democratic or republican at any given time, including gov_gop and gov_dem (number of Republican and Democratic governors), sen_gop and sen_dem (senators), and rep_gop and rep_dem (representatives). The dataset also includes indicators for the party of the sitting president (prez_gop and prez_dem). The 'mon' variable in the original file was converted to separate 'year' and 'month' columns for clarity.   

Dealing with the data in snp.csv.  
```{r}
snp_df = read_csv("fivethirtyeight_datasets/snp.csv") |>
  separate(date, into = c("month", "day", "year"), sep = "/") |> 
  mutate(
    year = as.integer(if_else(as.integer(year) > 50, paste0("19", year), paste0("20", year))),
    month = as.integer(month),
    month = month.name[month]
  ) |>
  select(year, month, close) |>
  arrange(year, match(month, month.name))
snp_df
```
snp_df dataset related to Standard & Poorâ€™s stock market index (S&P), often used as a representative measure of stock market as a whole and provided for this analysis contains 787 monthly observations from 1951 onward, with two key variables: date, the observation date, and close, the closing value of the S&P 500 index on that date.   

Dealing with the data in unemployment.cvs
```{r}
unemp_df = read_csv("fivethirtyeight_datasets/unemployment.csv")|>
  pivot_longer(
    cols = Jan:Dec,
    names_to = "month",
    values_to = "unemployment"
  ) |>
  mutate(month = recode(month,
                        Jan="January", Feb="February", Mar="March",
                        Apr="April", May="May", Jun="June",
                        Jul="July", Aug="August", Sep="September",
                        Oct="October", Nov="November", Dec="December")) |>
  rename(year = Year)
unemp_df

```
unemp_df dataset contains monthly U.S. unemployment rates from 1948 to 2015, with 816 observations and three variables: year, month, and unemployment rate in the month of the associated year.

Merging the datasets and give brief discription
```{r}
merged_df = pols_df |>
  left_join(snp_df, by = c("year", "month")) |>
  left_join(unemp_df, by = c("year", "month"))

merged_df
```

```{r}
tibble(
  Rows = nrow(merged_df),
  Columns = ncol(merged_df),
  Year_Min = min(merged_df$year, na.rm = TRUE),
  Year_Max = max(merged_df$year, na.rm = TRUE)
)
```
resulting dataset is a tidy, merged compilation of political, economic, and financial data, containing 822 rows and 11 variables, spanning the years 1947 to 2015. Key variables include 'year' and 'month' to identify the time period, political seat counts for Republicans and Democrats in the House and Senate (gov_gop, sen_gop, rep_gop, gov_dem, sen_dem, rep_dem), the party of the sitting president (president), the monthly closing value of the S&P 500 (close), and the monthly U.S. unemployment rate (unemployment). 

#Problem 2. 

```{r}
mr_trash_wheel = read_excel(
  "202409 Trash Wheel Collection Data.xlsx",sheet = "Mr. Trash Wheel", skip = 1) |>
  janitor::clean_names() |>      
  filter(!is.na(dumpster)) |>    
  mutate(
    year = as.integer(year),
    sports_balls = as.integer(round(sports_balls)),
    trash_wheel = "Mr. Trash Wheel"
  )
mr_trash_wheel
```

```{r}
prof_trash_wheel = read_excel(
  "202409 Trash Wheel Collection Data.xlsx",
  sheet = "Professor Trash Wheel",
  skip = 1,
) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster))|>
  mutate(
    year = as.integer(year)
  )
prof_trash_wheel
```

```{r}
gwynnda = read_excel(
  "202409 Trash Wheel Collection Data.xlsx",
  sheet = "Gwynnda Trash Wheel",
  skip = 1,
) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster))|>
  mutate(
    year = as.integer(year)
  )
gwynnda

trash_wheel_data = bind_rows(mr_trash_wheel, prof_trash_wheel, gwynnda)
trash_wheel_data
```
The combined trash collection dataset contains `r nrow(trash_wheel_data)` observations across multiple trash wheels, including Mr. Trash Wheel, Professor Trash Wheel, and Gwynnda. Key variables include `dumpster`, `month`, `year`, `weight_tons` (the weight of trash collected), `cigarette_butts`, `plastic_bottles`, and `trash_wheel` (the collector). Across the available data, the total weight of trash collected by Professor Trash Wheel was `r sum(trash_wheel_data$weight_tons[trash_wheel_data$trash_wheel == "Professor Trash Wheel"], na.rm = TRUE)` tons. In June 2022, Gwynnda collected a total of `r sum(trash_wheel_data$cigarette_butts[trash_wheel_data$trash_wheel == "Gwynnda" & trash_wheel_data$month == "June" & trash_wheel_data$year == 2022], na.rm = TRUE)` cigarette butts.


#Problem 3. 
```{r}
zip_df = read_csv(
  "zillow_data/Zip Codes.csv"
  ) |> 
  janitor::clean_names() |>
  mutate(zip = as.character(zip_code))

zori_wide = read_csv(
  "zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv"
  ) |> 
  janitor::clean_names()

zip_df
```

```{r}
zori_long = zori_wide |>
  pivot_longer(
    cols = starts_with("x"),  
    names_to = "date",
    values_to = "zori"
  ) |>
  mutate(
    date = ymd(str_remove(date, "^x")),  
    zori = as.numeric(zori),
    zip = str_pad(region_name, 5, pad = "0")  
  ) |>
  drop_na(zori)

zori_long
```


```{r}
zori_merged = zori_long |>
  left_join(zip_df, by = "zip") |>
  select(zip, county, neighborhood, date, zori, everything())

zori_merged
```

The dataset contains `r nrow(zori_merged)` total observations, covering `r n_distinct(zori_long$zip)` unique ZIP codes in the ZORI data and `r n_distinct(zip_df$zip)` unique ZIP codes in the lookup table. The number of unique neighborhoods is `r n_distinct(zip_df$neighborhood)`.

```{r}
missing_zips <- setdiff(zip_df$zip, zori_long$zip)
missing_zips
```
169 ZIP codes appear in the ZIP code dataset but not in the Zillow Rental Price dataset.


```{r}
jan2020 = zori_long |> 
  filter(year(date) == 2020, month(date) == 1) |> 
  select(zip, zori) |> 
  rename(zori_2020 = zori)

jan2021 = zori_long |> 
  filter(year(date) == 2021, month(date) == 1) |> 
  select(zip, zori) |> 
  rename(zori_2021 = zori)

comp = inner_join(jan2020, jan2021, by = "zip") |>
  mutate(drop = zori_2021 - zori_2020) |>
  left_join(zip_df |>
              select(zip, neighborhood, county), 
            by = "zip")

top10_drops = comp |> 
  arrange(drop) |> 
  slice(1:10)

top10_drops
```





